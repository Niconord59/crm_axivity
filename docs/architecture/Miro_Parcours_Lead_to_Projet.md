# CRM Axivity - Parcours Complet : Lead → Projet

> **Document pour Miro** - Schémas et flux utilisateur
>
> **Import Miro** : Copier-coller les sections dans des frames Miro ou utiliser les coordonnées suggérées pour recréer le flowchart.

---

## 1. Vue d'Ensemble du Parcours

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                 │
│   ┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐       │
│   │          │      │          │      │          │      │          │      │          │      │          │       │
│   │   LEAD   │ ───▶ │  APPEL   │ ───▶ │   RDV    │ ───▶ │  OPPORT  │ ───▶ │  PROJET  │ ───▶ │  TÂCHES  │       │
│   │          │      │          │      │          │      │          │      │          │      │          │       │
│   └──────────┘      └──────────┘      └──────────┘      └──────────┘      └──────────┘      └──────────┘       │
│                                                                                                                 │
│   ┌─────────────────────────────────────────┐  ┌──────────────────────┐  ┌──────────────────────────────────┐  │
│   │         MODULE PROSPECTION              │  │   PIPELINE KANBAN    │  │      GESTION DE PROJET           │  │
│   │              /prospection               │  │    /opportunites     │  │   /projets + /taches             │  │
│   └─────────────────────────────────────────┘  └──────────────────────┘  └──────────────────────────────────┘  │
│                                                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Légende des Couleurs (pour Miro)

| Couleur | Code Hex | Signification |
|---------|----------|---------------|
| 🔵 Bleu | `#3B82F6` | Actions utilisateur |
| 🟢 Vert | `#22C55E` | Succès / Validation |
| 🟠 Orange | `#F97316` | En attente / À traiter |
| 🔴 Rouge | `#EF4444` | Échec / Perdu |
| 🟣 Violet | `#8B5CF6` | Automatisation (N8N) |
| ⚫ Gris | `#6B7280` | Système / Backend |

---

## 3. PHASE 1 : Création du Lead

### Swimlane : Commercial

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 1 : CRÉATION DU LEAD                                                             │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────┐                                                               │
│   │                     │                                                               │
│   │   Page /prospection │                                                               │
│   │                     │                                                               │
│   └──────────┬──────────┘                                                               │
│              │                                                                          │
│              ▼                                                                          │
│   ┌──────────────────────────────────────────────────────────────────┐                  │
│   │                    2 MÉTHODES DE CRÉATION                        │                  │
│   └──────────────────────────────────────────────────────────────────┘                  │
│              │                                          │                               │
│              ▼                                          ▼                               │
│   ┌─────────────────────┐                 ┌─────────────────────────┐                   │
│   │  🔵 Import CSV      │                 │  🔵 Création Manuelle   │                   │
│   │                     │                 │                         │                   │
│   │  • Fichier CSV      │                 │  • Bouton "+ Lead"      │                   │
│   │  • Mapping colonnes │                 │  • Formulaire direct    │                   │
│   │  • Import batch     │                 │  • Recherche entreprise │                   │
│   └──────────┬──────────┘                 └────────────┬────────────┘                   │
│              │                                         │                                │
│              │                                         ▼                                │
│              │                            ┌─────────────────────────┐                   │
│              │                            │  API Gouvernement       │                   │
│              │                            │  recherche-entreprises  │                   │
│              │                            │  .api.gouv.fr           │                   │
│              │                            │                         │                   │
│              │                            │  Auto-remplit :         │                   │
│              │                            │  • SIRET                │                   │
│              │                            │  • Adresse              │                   │
│              │                            │  • Secteur              │                   │
│              │                            └────────────┬────────────┘                   │
│              │                                         │                                │
│              │                                         ▼                                │
│              │                            ┌─────────────────────────┐                   │
│              │                            │  Google Places API      │                   │
│              │                            │  (optionnel)            │                   │
│              │                            │                         │                   │
│              │                            │  Enrichit :             │                   │
│              │                            │  • Téléphone            │                   │
│              │                            │  • Site web             │                   │
│              │                            └────────────┬────────────┘                   │
│              │                                         │                                │
│              └────────────────────┬────────────────────┘                                │
│                                   ▼                                                     │
│                      ┌─────────────────────────┐                                        │
│                      │  ⚫ Supabase            │                                        │
│                      │                         │                                        │
│                      │  Tables créées :        │                                        │
│                      │  • clients (entreprise) │                                        │
│                      │  • contacts (personne)  │                                        │
│                      │                         │                                        │
│                      │  Statut initial :       │                                        │
│                      │  "À appeler"            │                                        │
│                      └─────────────────────────┘                                        │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### Données créées

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  TABLES SUPABASE CRÉÉES                                                                 │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────┐         ┌─────────────────────────────┐               │
│   │  TABLE: clients             │         │  TABLE: contacts            │               │
│   ├─────────────────────────────┤         ├─────────────────────────────┤               │
│   │  id (UUID)                  │◀────────│  client_id (FK)             │               │
│   │  nom                        │         │  id (UUID)                  │               │
│   │  siret                      │         │  nom, prenom                │               │
│   │  secteur_activite           │         │  email, telephone           │               │
│   │  adresse, ville, cp         │         │  poste                      │               │
│   │  telephone, site_web        │         │  statut_prospection ────────┼──▶ "À appeler"│
│   │  statut ────────────────────┼──▶      │  source_lead                │               │
│   │           "Prospect"        │         │  notes_prospection          │               │
│   └─────────────────────────────┘         └─────────────────────────────┘               │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. PHASE 2 : Qualification du Lead (Prospection)

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 2 : QUALIFICATION DU LEAD                                                        │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                           KANBAN PROSPECTION                                    │   │
│   │                              /prospection                                       │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐            │
│   │ 🟠        │  │ 🟠        │  │ 🔵        │  │ 🔵        │  │ 🟢        │            │
│   │ À appeler │  │ Rappeler  │  │ RDV       │  │ RDV       │  │ Qualifié  │            │
│   │           │  │           │  │ planifié  │  │ effectué  │  │           │            │
│   │  ┌─────┐  │  │  ┌─────┐  │  │  ┌─────┐  │  │  ┌─────┐  │  │  ┌─────┐  │            │
│   │  │Lead │  │  │  │Lead │  │  │  │Lead │  │  │  │Lead │  │  │  │Lead │  │            │
│   │  │Card │──┼──┼─▶│Card │──┼──┼─▶│Card │──┼──┼─▶│Card │──┼──┼─▶│Card │  │            │
│   │  └─────┘  │  │  └─────┘  │  │  └─────┘  │  │  └─────┘  │  │  └─────┘  │            │
│   └───────────┘  └───────────┘  └───────────┘  └───────────┘  └───────────┘            │
│                                                     │               │                   │
│                                                     │               │                   │
│   ┌───────────┐  ┌───────────┐                      │               │                   │
│   │ 🔴        │  │ 🔴        │                      │               │                   │
│   │ Non       │  │ Perdu     │                      │               │                   │
│   │ qualifié  │  │           │                      │               │                   │
│   └───────────┘  └───────────┘                      │               │                   │
│                                                     │               │                   │
│                                                     ▼               ▼                   │
│                                          ┌─────────────────────────────────┐            │
│                                          │  🔵 BOUTON "CONVERTIR"          │            │
│                                          │     Créer une opportunité       │            │
│                                          └─────────────────────────────────┘            │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### Détail des actions de prospection

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  ACTIONS SUR UNE LEADCARD                                                               │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────┐                                                               │
│   │                     │                                                               │
│   │      LeadCard       │                                                               │
│   │   (clic = ouvrir)   │                                                               │
│   │                     │                                                               │
│   └──────────┬──────────┘                                                               │
│              │                                                                          │
│              ▼                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                         FORMULAIRE PROSPECT                                     │   │
│   │                         (ProspectForm.tsx)                                      │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│              │                                                                          │
│              ├────────────────────────┬────────────────────────┬───────────────────┐    │
│              ▼                        ▼                        ▼                   ▼    │
│   ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐  ┌───────────┐ │
│   │ 📞 APPEL        │      │ 📅 PLANIFIER    │      │ ✉️ EMAIL        │  │ 🔄 STATUT │ │
│   │                 │      │    RDV          │      │                 │  │           │ │
│   │ CallResultDialog│      │                 │      │ EmailComposer   │  │ Dropdown  │ │
│   │                 │      │ CreateEvent     │      │                 │  │           │ │
│   │ • Répondu       │      │ Dialog          │      │ • Template auto │  │           │ │
│   │ • Pas répondu   │      │                 │      │ • Gmail/Outlook │  │           │ │
│   │ • Rappeler      │      │ • Google Cal    │      │ • Envoi direct  │  │           │ │
│   │ • RDV obtenu    │      │ • Microsoft 365 │      │                 │  │           │ │
│   │ • Non qualifié  │      │ • Visio/Présen. │      │                 │  │           │ │
│   └────────┬────────┘      └────────┬────────┘      └────────┬────────┘  └─────┬─────┘ │
│            │                        │                        │                 │       │
│            ▼                        ▼                        ▼                 ▼       │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                    ⚫ SUPABASE : Mise à jour contact                            │   │
│   │                    + Création interaction (historique)                          │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. PHASE 3 : Conversion Lead → Opportunité

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 3 : CONVERSION EN OPPORTUNITÉ                                                    │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  DÉCLENCHEUR : Bouton "Convertir en opportunité" sur LeadCard                   │   │
│   │                (statut = "Qualifié" ou "RDV effectué")                          │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                      useConvertToOpportunity()                                  │   │
│   │                         (Frontend React)                                        │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                    ┌─────────────────────┼─────────────────────┐                        │
│                    │                     │                     │                        │
│                    ▼                     ▼                     ▼                        │
│         ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐                │
│         │ 1. CRÉER         │  │ 2. METTRE À JOUR │  │ 3. METTRE À JOUR │                │
│         │    OPPORTUNITÉ   │  │    CONTACT       │  │    CLIENT        │                │
│         │                  │  │                  │  │                  │                │
│         │ INSERT INTO      │  │ UPDATE contacts  │  │ UPDATE clients   │                │
│         │ opportunites     │  │ SET statut =     │  │ SET statut =     │                │
│         │                  │  │   "Qualifié"     │  │   "Actif"        │                │
│         │ • nom            │  │                  │  │ (si = Prospect)  │                │
│         │ • client_id      │  │                  │  │                  │                │
│         │ • contact_id     │  │                  │  │                  │                │
│         │ • statut =       │  │                  │  │                  │                │
│         │   "Qualifié"     │  │                  │  │                  │                │
│         │ • probabilité =  │  │                  │  │                  │                │
│         │   20%            │  │                  │  │                  │                │
│         │ • date_cloture = │  │                  │  │                  │                │
│         │   +30 jours      │  │                  │  │                  │                │
│         └──────────────────┘  └──────────────────┘  └──────────────────┘                │
│                                          │                                              │
│                                          ▼                                              │
│         ┌───────────────────────────────────────────────────────────────────────────┐   │
│         │  L'opportunité apparaît dans le Pipeline Commercial (/opportunites)      │   │
│         │  Colonne "Qualifié"                                                       │   │
│         └───────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. PHASE 4 : Pipeline Commercial (Opportunités)

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 4 : PIPELINE COMMERCIAL                                                          │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                           KANBAN OPPORTUNITÉS                                   │   │
│   │                             /opportunites                                       │   │
│   │                          (Drag & Drop activé)                                   │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│   ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐            │
│   │ 🔵        │  │ 🟣        │  │ 🟠        │  │ 🟢        │  │ 🔴        │            │
│   │ Qualifié  │  │Proposition│  │Négociation│  │  Gagné    │  │  Perdu    │            │
│   │           │  │           │  │           │  │           │  │           │            │
│   │  ┌─────┐  │  │  ┌─────┐  │  │  ┌─────┐  │  │  ┌─────┐  │  │  ┌─────┐  │            │
│   │  │Opp. │  │  │  │Opp. │  │  │  │Opp. │  │  │  │Opp. │  │  │  │Opp. │  │            │
│   │  │Card │──┼──┼─▶│Card │──┼──┼─▶│Card │──┼──┼─▶│Card │  │  │  │Card │  │            │
│   │  └──┬──┘  │  │  └──┬──┘  │  │  └──┬──┘  │  │  └──┬──┘  │  │  └─────┘  │            │
│   │     │     │  │     │     │  │     │     │  │     │     │  │           │            │
│   └─────┼─────┘  └─────┼─────┘  └─────┼─────┘  └─────┼─────┘  └───────────┘            │
│         │              │              │              │                                  │
│         └──────────────┴──────────────┴──────────────┘                                  │
│                                       │                                                 │
│                                       ▼                                                 │
│                          ┌─────────────────────────┐                                    │
│                          │  CLIC SUR CARTE         │                                    │
│                          │  → OpportunityMiniSheet │                                    │
│                          └─────────────────────────┘                                    │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### Détail OpportunityMiniSheet

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  OPPORTUNITYMINISHEET (Drawer latéral)                                                  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  ┌─────────────────────────────────────────────────────────────────────────┐    │   │
│   │  │  ONGLET INFOS                                                           │    │   │
│   │  ├─────────────────────────────────────────────────────────────────────────┤    │   │
│   │  │                                                                         │    │   │
│   │  │  Montant estimé                                                         │    │   │
│   │  │  ┌─────┬─────┬─────┬─────┬─────┬─────┐                                  │    │   │
│   │  │  │ 5k  │ 10k │ 25k │ 50k │100k │200k │  ← Boutons présets               │    │   │
│   │  │  └─────┴─────┴─────┴─────┴─────┴─────┘                                  │    │   │
│   │  │  ┌─────┬─────┬─────┬─────┐                                              │    │   │
│   │  │  │ -5k │ -1k │ +1k │ +5k │  ← Ajustements                               │    │   │
│   │  │  └─────┴─────┴─────┴─────┘                                              │    │   │
│   │  │                                                                         │    │   │
│   │  │  Probabilité                                                            │    │   │
│   │  │  ├──────────●────────────────────────────┤ 35%                          │    │   │
│   │  │  0%                                    100%                              │    │   │
│   │  │                                                                         │    │   │
│   │  │  Valeur pondérée : 17 500 €                                             │    │   │
│   │  │                                                                         │    │   │
│   │  │  Date de clôture prévue : [📅 15/02/2025]                               │    │   │
│   │  │                                                                         │    │   │
│   │  │  ┌─────────────────────────────────────────────────────────────────┐    │    │   │
│   │  │  │  🔵 CRÉER UN DEVIS                                              │    │    │   │
│   │  │  └─────────────────────────────────────────────────────────────────┘    │    │   │
│   │  │                                                                         │    │   │
│   │  └─────────────────────────────────────────────────────────────────────────┘    │   │
│   │                                                                                 │   │
│   │  ┌─────────────────────────────────────────────────────────────────────────┐    │   │
│   │  │  ONGLET HISTORIQUE                                                      │    │   │
│   │  ├─────────────────────────────────────────────────────────────────────────┤    │   │
│   │  │                                                                         │    │   │
│   │  │  ┌─────────────────────────────────────────────────────────────────┐    │    │   │
│   │  │  │ 📞 05/01 - Appel de qualification                               │    │    │   │
│   │  │  │    Prospect intéressé, demande devis                            │    │    │   │
│   │  │  └─────────────────────────────────────────────────────────────────┘    │    │   │
│   │  │  ┌─────────────────────────────────────────────────────────────────┐    │    │   │
│   │  │  │ 📧 03/01 - Email de premier contact                             │    │    │   │
│   │  │  │    Présentation des services                                    │    │    │   │
│   │  │  └─────────────────────────────────────────────────────────────────┘    │    │   │
│   │  │                                                                         │    │   │
│   │  │  ┌─────────────────────────────────────────────────────────────────┐    │    │   │
│   │  │  │ 📝 Ajouter une note                                 [Ajouter]  │    │    │   │
│   │  │  └─────────────────────────────────────────────────────────────────┘    │    │   │
│   │  │                                                                         │    │   │
│   │  └─────────────────────────────────────────────────────────────────────────┘    │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### Création de Devis

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  CRÉATION DE DEVIS                                                                      │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────┐                                                               │
│   │ Bouton "Créer devis"│                                                               │
│   └──────────┬──────────┘                                                               │
│              │                                                                          │
│              ▼                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                         QuoteEditorSheet                                        │   │
│   │                                                                                 │   │
│   │  ┌───────────────────────────────────────────────────────────────────────────┐  │   │
│   │  │  SÉLECTION SERVICES (Catalogue)                                           │  │   │
│   │  │  ┌──────────────────────────────────────────────────────────────────────┐ │  │   │
│   │  │  │ Service                    │ Qté │ Prix U. │ Remise │ Total HT      │ │  │   │
│   │  │  ├──────────────────────────────────────────────────────────────────────┤ │  │   │
│   │  │  │ Développement chatbot IA   │  1  │ 5000 €  │   0%   │ 5 000 €       │ │  │   │
│   │  │  │ Formation équipe           │  2  │  500 €  │  10%   │   900 €       │ │  │   │
│   │  │  │ Support 3 mois             │  1  │ 1500 €  │   0%   │ 1 500 €       │ │  │   │
│   │  │  └──────────────────────────────────────────────────────────────────────┘ │  │   │
│   │  │                                                                           │  │   │
│   │  │                                         Total HT :    7 400 €             │  │   │
│   │  │                                         TVA (20%) :   1 480 €             │  │   │
│   │  │                                         Total TTC :   8 880 €             │  │   │
│   │  └───────────────────────────────────────────────────────────────────────────┘  │   │
│   │                                                                                 │   │
│   │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │   │
│   │  │ 👁️ Prévisualiser │  │ 📄 Générer PDF │  │ ✉️ Envoyer      │                  │   │
│   │  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │   │
│   │                              │                      │                           │   │
│   │                              ▼                      ▼                           │   │
│   │                    ┌──────────────────┐   ┌──────────────────┐                  │   │
│   │                    │ API Puppeteer    │   │ API Resend       │                  │   │
│   │                    │ Génère PDF       │   │ Envoie email     │                  │   │
│   │                    │ DEV-2025-001     │   │ + pièce jointe   │                  │   │
│   │                    └──────────────────┘   └──────────────────┘                  │   │
│   │                                                                                 │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. PHASE 5 : Conversion Opportunité → Projet (N8N)

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 5 : CONVERSION AUTOMATIQUE EN PROJET                                             │
│  🟣 AUTOMATISATION N8N                                                                  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  DÉCLENCHEUR : Opportunité déplacée vers colonne "Gagné"                        │   │
│   │                (Drag & Drop dans le Kanban)                                     │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  🟣 WORKFLOW N8N : supabase_conversion_opportunite_projet.json                  │   │
│   │     Exécution : Toutes les minutes                                              │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  1. RECHERCHE                                                                   │   │
│   │     SELECT * FROM opportunites                                                  │   │
│   │     WHERE statut = 'Gagné' AND projet_id IS NULL                                │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                          ┌───────────────┴───────────────┐                              │
│                          ▼                               ▼                              │
│                   ┌─────────────┐               ┌─────────────┐                         │
│                   │ OUI : Opps  │               │ NON : Rien  │                         │
│                   │ à convertir │               │ à faire     │                         │
│                   └──────┬──────┘               └─────────────┘                         │
│                          │                                                              │
│                          ▼                                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  2. RÉCUPÉRER CLIENT                                                            │   │
│   │     SELECT * FROM clients WHERE id = opportunite.client_id                      │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  3. CRÉER PROJET                                                                │   │
│   │     INSERT INTO projets (                                                       │   │
│   │       nom = opportunite.nom,                                                    │   │
│   │       client_id = opportunite.client_id,                                        │   │
│   │       budget_initial = opportunite.valeur_estimee,                              │   │
│   │       date_debut = aujourd'hui,                                                 │   │
│   │       date_fin_prevue = +4 semaines,                                            │   │
│   │       statut = 'Cadrage',                                                       │   │
│   │       notes = opportunite.notes                                                 │   │
│   │     )                                                                           │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  4. LIER PROJET À OPPORTUNITÉ                                                   │   │
│   │     UPDATE opportunites SET projet_id = nouveau_projet.id                       │   │
│   │     WHERE id = opportunite.id                                                   │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                    ┌─────────────────────┴─────────────────────┐                        │
│                    ▼                                           ▼                        │
│   ┌─────────────────────────────────┐         ┌─────────────────────────────────────┐   │
│   │  5a. NOTIFICATION SLACK         │         │  5b. NOTIFICATION EMAIL             │   │
│   │                                 │         │                                     │   │
│   │  🎉 Nouvelle affaire signée !   │         │  To: equipe@axivity.fr              │   │
│   │  Projet: {nom}                  │         │  Subject: Nouvelle affaire signée   │   │
│   │  Client: {client}               │         │  Body: Template HTML complet        │   │
│   │  Budget: {montant} €            │         │                                     │   │
│   │  [Voir le projet]               │         │                                     │   │
│   └─────────────────────────────────┘         └─────────────────────────────────────┘   │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  6. LOGGER DANS CHANGELOG                                                       │   │
│   │     INSERT INTO changelog (description, type = 'Feature')                       │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. PHASE 6 : Gestion du Projet

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 6 : GESTION DU PROJET                                                            │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                           PAGE PROJET /projets/[id]                             │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│   ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│   │  HEADER                                                                           │ │
│   │  ┌─────────────────────────────────────────────────────────────────────────────┐  │ │
│   │  │  P42 - Refonte site web avec IA             [En cours]        [Modifier]    │  │ │
│   │  │  👤 Responsable : Jean Dupont                                               │  │ │
│   │  └─────────────────────────────────────────────────────────────────────────────┘  │ │
│   └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│   ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│   │  KPIs                                                                             │ │
│   │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐              │ │
│   │  │ 📊 Progress  │ │ 💰 Budget    │ │ 📅 Échéance  │ │ ✅ Tâches    │              │ │
│   │  │    65%       │ │   15 000 €   │ │  15/03/2025  │ │   8/12       │              │ │
│   │  │  ████████░░  │ │ Facturé: 5k  │ │ Début: 01/02 │ │ 24h/36h est. │              │ │
│   │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘              │ │
│   └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│   ┌───────────────────────────────────────────────────────────────────────────────────┐ │
│   │  MINI-KANBAN TÂCHES (lecture seule)                                               │ │
│   │                                                                                   │ │
│   │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐                       │ │
│   │  │ À faire   │  │ En cours  │  │ En revue  │  │ Terminé   │                       │ │
│   │  │     3     │  │     2     │  │     1     │  │     6     │                       │ │
│   │  │ ┌───────┐ │  │ ┌───────┐ │  │ ┌───────┐ │  │ ┌───────┐ │                       │ │
│   │  │ │Tâche 1│ │  │ │Tâche 4│ │  │ │Tâche 6│ │  │ │Tâche 7│ │                       │ │
│   │  │ └───────┘ │  │ └───────┘ │  │ └───────┘ │  │ └───────┘ │                       │ │
│   │  │ ┌───────┐ │  │ ┌───────┐ │  │           │  │ ┌───────┐ │                       │ │
│   │  │ │Tâche 2│ │  │ │Tâche 5│ │  │           │  │ │Tâche 8│ │                       │ │
│   │  │ └───────┘ │  │ └───────┘ │  │           │  │ └───────┘ │                       │ │
│   │  └───────────┘  └───────────┘  └───────────┘  └───────────┘                       │ │
│   └───────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### Attribution du responsable projet

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  ATTRIBUTION RESPONSABLE PROJET                                                         │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────┐                                                               │
│   │ Bouton "Modifier"   │                                                               │
│   │ sur la page projet  │                                                               │
│   └──────────┬──────────┘                                                               │
│              │                                                                          │
│              ▼                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                            ProjetForm                                           │   │
│   │                                                                                 │   │
│   │  Brief du projet *      [Refonte site web avec IA intégrée_______________]      │   │
│   │                                                                                 │   │
│   │  Responsable            [Sélectionner un responsable              ▾]            │   │
│   │                         ┌─────────────────────────────────────────┐             │   │
│   │                         │ ○ Aucun responsable                     │             │   │
│   │                         │ ○ Jean Dupont (admin)                   │             │   │
│   │                         │ ○ Marie Martin (developpeur_nocode)     │             │   │
│   │                         │ ○ Pierre Durand (commercial)            │             │   │
│   │                         └─────────────────────────────────────────┘             │   │
│   │                                                                                 │   │
│   │  Budget (€) *           [15000______]     Priorité  [Haute     ▾]               │   │
│   │                                                                                 │   │
│   │  Date de début *        [2025-02-01]      Date fin  [2025-03-15]                │   │
│   │                                                                                 │   │
│   │  Statut *               [En cours  ▾]                                           │   │
│   │                                                                                 │   │
│   │                                                       [Enregistrer]             │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│   ⚫ UPDATE projets SET owner_id = selected_user.id WHERE id = projet.id                │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. PHASE 7 : Création et Gestion des Tâches

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 7 : CRÉATION DES TÂCHES                                                          │
│  ⚠️ 100% MANUEL - Pas de génération automatique                                         │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                              PAGE /taches                                       │   │
│   │                         Bouton "+ Nouvelle tâche"                               │   │
│   └──────────────────────────────────────┬──────────────────────────────────────────┘   │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                            TacheForm                                            │   │
│   │                                                                                 │   │
│   │  Nom de la tâche *      [Maquettes page d'accueil_______________________]       │   │
│   │                                                                                 │   │
│   │  Projet *               [P42 - Refonte site web                      ▾]         │   │
│   │                                                                                 │   │
│   │  Responsable  [Marie Martin  ▾]      Date d'échéance * [2025-02-10____]         │   │
│   │                                                                                 │   │
│   │  Priorité *  [Haute ▾]  Statut * [À faire▾]  Heures estimées [8_______]         │   │
│   │                                                                                 │   │
│   │  Description  [Créer les maquettes Figma pour la page d'accueil______]          │   │
│   │               [avec les composants IA_________________________________]          │   │
│   │                                                                                 │   │
│   │                                                            [Créer]              │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  ⚫ Supabase : INSERT INTO taches                                               │   │
│   │                                                                                 │   │
│   │  • nom = "Maquettes page d'accueil"                                             │   │
│   │  • projet_id = P42.id                                                           │   │
│   │  • assignee_id = marie.id (membre équipe)                                       │   │
│   │  • date_echeance = 2025-02-10                                                   │   │
│   │  • priorite = "Haute"                                                           │   │
│   │  • statut = "À faire"                                                           │   │
│   │  • heures_estimees = 8                                                          │   │
│   │  • description = "..."                                                          │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  Invalidation React Query :                                                     │   │
│   │  • queryKeys.taches.all                                                         │   │
│   │  • queryKeys.projets.all (mise à jour compteurs)                                │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### Cycle de vie d'une tâche

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  CYCLE DE VIE D'UNE TÂCHE                                                               │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│   ┌───────────────┐      ┌───────────────┐      ┌───────────────┐      ┌─────────────┐  │
│   │               │      │               │      │               │      │             │  │
│   │   À faire     │ ───▶ │   En cours    │ ───▶ │   En revue    │ ───▶ │  Terminé    │  │
│   │               │      │               │      │               │      │             │  │
│   │   (Gris)      │      │   (Bleu)      │      │   (Violet)    │      │  (Vert)     │  │
│   │               │      │               │      │               │      │             │  │
│   └───────────────┘      └───────────────┘      └───────────────┘      └─────────────┘  │
│          │                      │                      │                     │          │
│          │                      │                      │                     │          │
│          ▼                      ▼                      ▼                     ▼          │
│   ┌─────────────┐        ┌─────────────┐        ┌─────────────┐       ┌───────────────┐ │
│   │ Assignation │        │ Temps passé │        │ Validation  │       │ date_terminee │ │
│   │ responsable │        │ (heures)    │        │ par chef    │       │ = aujourd'hui │ │
│   └─────────────┘        └─────────────┘        └─────────────┘       └───────────────┘ │
│                                                                                         │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  🟣 WORKFLOW N8N : supabase_alertes_taches_retard.json                          │   │
│   │     Quotidien 9h (Lun-Ven)                                                      │   │
│   │     Notifie si date_echeance < aujourd'hui AND statut != 'Terminé'              │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 10. SCHÉMA RÉCAPITULATIF COMPLET

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                     │
│                                           CRM AXIVITY - PARCOURS COMPLET                                                            │
│                                                                                                                                     │
├──────────────────────────────────────────────────────┬──────────────────────────────────┬───────────────────────────────────────────┤
│              PROSPECTION                             │         COMMERCIAL               │           PRODUCTION                      │
│              /prospection                            │        /opportunites             │      /projets + /taches                   │
├──────────────────────────────────────────────────────┼──────────────────────────────────┼───────────────────────────────────────────┤
│                                                      │                                  │                                           │
│   ┌──────────┐                                       │                                  │                                           │
│   │ 📥 IMPORT│                                       │                                  │                                           │
│   │   CSV    │                                       │                                  │                                           │
│   └────┬─────┘                                       │                                  │                                           │
│        │           ┌──────────┐                      │                                  │                                           │
│        └──────────▶│          │                      │                                  │                                           │
│                    │   LEAD   │                      │                                  │                                           │
│   ┌──────────┐     │          │                      │                                  │                                           │
│   │ ➕ CRÉER ├────▶│ À appeler│                      │                                  │                                           │
│   │  MANUEL  │     │          │                      │                                  │                                           │
│   └──────────┘     └────┬─────┘                      │                                  │                                           │
│                         │                            │                                  │                                           │
│                         ▼                            │                                  │                                           │
│                    ┌──────────┐                      │                                  │                                           │
│                    │ 📞 APPEL │                      │                                  │                                           │
│                    │          │                      │                                  │                                           │
│                    │ Rappeler │                      │                                  │                                           │
│                    └────┬─────┘                      │                                  │                                           │
│                         │                            │                                  │                                           │
│                         ▼                            │                                  │                                           │
│                    ┌──────────┐                      │                                  │                                           │
│                    │ 📅 RDV   │                      │                                  │                                           │
│                    │ planifié │                      │                                  │                                           │
│                    │          │                      │                                  │                                           │
│                    │ (Google/ │                      │                                  │                                           │
│                    │ MS 365)  │                      │                                  │                                           │
│                    └────┬─────┘                      │                                  │                                           │
│                         │                            │                                  │                                           │
│                         ▼                            │                                  │                                           │
│                    ┌──────────┐                      │                                  │                                           │
│                    │ ✅ RDV   │                      │                                  │                                           │
│                    │ effectué │                      │                                  │                                           │
│                    └────┬─────┘                      │                                  │                                           │
│                         │                            │                                  │                                           │
│                         ▼                            │                                  │                                           │
│                    ┌──────────┐      ┌─────────┐     │                                  │                                           │
│                    │ 🟢       │      │CONVERTIR│     │  ┌──────────┐                    │                                           │
│                    │ Qualifié │─────▶│         │─────┼─▶│ 🔵       │                    │                                           │
│                    │          │      └─────────┘     │  │ Qualifié │                    │                                           │
│                    └──────────┘                      │  └────┬─────┘                    │                                           │
│                                                      │       │                          │                                           │
│                                                      │       ▼                          │                                           │
│                                                      │  ┌──────────┐                    │                                           │
│                                                      │  │ 📄 DEVIS │                    │                                           │
│                                                      │  │          │                    │                                           │
│                                                      │  │Proposition│                   │                                           │
│                                                      │  └────┬─────┘                    │                                           │
│                                                      │       │                          │                                           │
│                                                      │       ▼                          │                                           │
│                                                      │  ┌──────────┐                    │                                           │
│                                                      │  │ 🤝       │                    │                                           │
│                                                      │  │Négociation│                   │                                           │
│                                                      │  └────┬─────┘                    │                                           │
│                                                      │       │                          │                                           │
│                                                      │       ▼                          │                                           │
│                                                      │  ┌──────────┐      ┌─────────┐   │   ┌──────────┐                            │
│                                                      │  │ 🟢       │      │  🟣 N8N │   │   │          │                            │
│                                                      │  │  Gagné   │─────▶│  AUTO   │───┼──▶│  PROJET  │                            │
│                                                      │  │          │      │ (1 min) │   │   │  Cadrage │                            │
│                                                      │  └──────────┘      └─────────┘   │   └────┬─────┘                            │
│                                                      │                                  │        │                                  │
│                                                      │                                  │        ▼                                  │
│                                                      │                                  │   ┌──────────┐                            │
│                                                      │                                  │   │ 👤 ASSIGN│                            │
│                                                      │                                  │   │ Responsab│                            │
│                                                      │                                  │   │ (manuel) │                            │
│                                                      │                                  │   └────┬─────┘                            │
│                                                      │                                  │        │                                  │
│                                                      │                                  │        ▼                                  │
│                                                      │                                  │   ┌──────────┐                            │
│                                                      │                                  │   │ ➕ CRÉER │                            │
│                                                      │                                  │   │  TÂCHES  │                            │
│                                                      │                                  │   │ (manuel) │                            │
│                                                      │                                  │   └────┬─────┘                            │
│                                                      │                                  │        │                                  │
│                                                      │                                  │        ▼                                  │
│                                                      │                                  │   ┌──────────┐                            │
│                                                      │                                  │   │ 📋 KANBAN│                            │
│                                                      │                                  │   │  TÂCHES  │                            │
│                                                      │                                  │   │          │                            │
│                                                      │                                  │   │ À faire  │                            │
│                                                      │                                  │   │ En cours │                            │
│                                                      │                                  │   │ En revue │                            │
│                                                      │                                  │   │ Terminé  │                            │
│                                                      │                                  │   └────┬─────┘                            │
│                                                      │                                  │        │                                  │
│                                                      │                                  │        ▼                                  │
│                                                      │                                  │   ┌──────────┐                            │
│                                                      │                                  │   │ ✅ PROJET│                            │
│                                                      │                                  │   │ Terminé  │                            │
│                                                      │                                  │   └──────────┘                            │
│                                                      │                                  │                                           │
└──────────────────────────────────────────────────────┴──────────────────────────────────┴───────────────────────────────────────────┘
```

---

## 11. Instructions pour Miro

### Import dans Miro

1. **Créer un nouveau board** Miro
2. **Créer 3 frames** principales :
   - Frame "Prospection" (couleur bleue)
   - Frame "Commercial" (couleur violette)
   - Frame "Production" (couleur verte)

### Éléments à créer

| Élément | Type Miro | Couleur |
|---------|-----------|---------|
| Étapes utilisateur | Rectangle arrondi | Selon statut |
| Actions automatiques N8N | Hexagone | Violet `#8B5CF6` |
| Bases de données | Cylindre | Gris `#6B7280` |
| Décisions | Losange | Jaune `#EAB308` |
| Flèches | Connecteurs | Noir |

### Swimlanes suggérées

```
┌─────────────────────────────────────────────────────────────────────┐
│ COMMERCIAL           │ Actions manuelles du commercial             │
├─────────────────────────────────────────────────────────────────────┤
│ SYSTÈME              │ Traitements automatiques (N8N, Supabase)    │
├─────────────────────────────────────────────────────────────────────┤
│ CHEF DE PROJET       │ Actions de gestion de projet                │
├─────────────────────────────────────────────────────────────────────┤
│ ÉQUIPE               │ Exécution des tâches                        │
└─────────────────────────────────────────────────────────────────────┘
```

### Raccourcis Miro

- `R` : Rectangle
- `L` : Ligne/Connecteur
- `T` : Texte
- `S` : Sticky note
- `Ctrl+D` : Dupliquer

---

## 12. Fichiers de référence

| Composant | Fichier |
|-----------|---------|
| Import CSV | `src/components/prospection/LeadImportDialog.tsx` |
| Création Lead | `src/components/prospection/ProspectForm.tsx` |
| Conversion Opportunité | `src/hooks/use-convert-opportunity.ts` |
| Pipeline Kanban | `src/app/(main)/opportunites/page.tsx` |
| Création Devis | `src/components/devis/QuoteEditorSheet.tsx` |
| N8N Conversion | `Workflows_n8n/supabase_conversion_opportunite_projet.json` |
| Formulaire Projet | `src/components/forms/ProjetForm.tsx` |
| Formulaire Tâche | `src/components/forms/TacheForm.tsx` |

---

*Document généré le 05/01/2026 - CRM Axivity v1.0*
